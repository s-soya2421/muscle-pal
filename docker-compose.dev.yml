
services:
  # Development version with hot reload
  app:
    build: 
      context: .
      dockerfile: Dockerfile.dev
    container_name: muscle-pal-app-dev
    restart: unless-stopped
    depends_on:
      - kong
    environment:
      NODE_ENV: development
      NEXT_PUBLIC_SUPABASE_URL: http://localhost:8000
      NEXT_PUBLIC_SUPABASE_ANON_KEY: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZS1kZW1vIiwicm9sZSI6ImFub24iLCJleHAiOjE5ODM4MTI5OTZ9.CRXP1A7WOeoJeXxjNni43kdQwgnWNReilDMblYTn_I0
      SUPABASE_SERVICE_KEY: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZS1kZW1vIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImV4cCI6MTk4MzgxMjk5Nn0.EGIM96RAZx35lJzdJsyH-qQwv8Hdp7fsn3W0YpN81IU
      JWT_SECRET: your-super-secret-jwt-token-with-at-least-32-characters-long
      JWT_REFRESH_SECRET: your-refresh-secret-key-minimum-32-characters
      NEXT_PUBLIC_STORAGE_BASE_URL: http://localhost:8000/storage/v1/object/public
      SUPABASE_STORAGE_BUCKET: posts-images
      AUTO_MIGRATE: ${AUTO_MIGRATE:-false}
      SKIP_MIGRATION: ${SKIP_MIGRATION:-false}
    ports:
      - "3002:3000"
    volumes:
      - .:/app
      - /app/node_modules
      - /app/.next
    networks:
      - muscle-pal-network

  # Same Supabase services as in main docker-compose.yml
  db:
    extends:
      file: docker-compose.yml
      service: db

  auth:
    extends:
      file: docker-compose.yml
      service: auth

  rest:
    extends:
      file: docker-compose.yml
      service: rest

  realtime:
    extends:
      file: docker-compose.yml
      service: realtime

  storage:
    extends:
      file: docker-compose.yml
      service: storage

  imgproxy:
    extends:
      file: docker-compose.yml
      service: imgproxy

  kong:
    extends:
      file: docker-compose.yml
      service: kong

  inbucket:
    extends:
      file: docker-compose.yml
      service: inbucket

  studio:
    extends:
      file: docker-compose.yml
      service: studio

volumes:
  db_data:
    driver: local
  storage_data:
    driver: local

networks:
  muscle-pal-network:
    driver: bridge