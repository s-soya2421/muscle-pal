
services:
  # Development version with hot reload
  app:
    build: 
      context: .
      dockerfile: Dockerfile.dev
    container_name: muscle-pal-app-dev
    restart: unless-stopped
    depends_on:
      - kong
    environment:
      NODE_ENV: development
      # Client-side access via host network (browser accessible)
      NEXT_PUBLIC_SUPABASE_URL: http://localhost:8000
      # Server-side access via Docker internal network  
      SUPABASE_URL: http://kong:8000
      NEXT_PUBLIC_SUPABASE_ANON_KEY: ${NEXT_PUBLIC_SUPABASE_ANON_KEY:-demo-anon-key}
      SUPABASE_SERVICE_KEY: ${SUPABASE_SERVICE_KEY:-demo-service-key}
      JWT_SECRET: ${JWT_SECRET:-dev-jwt-secret-32-characters}
      JWT_REFRESH_SECRET: ${JWT_REFRESH_SECRET:-dev-refresh-secret-32-characters}
      NEXT_PUBLIC_STORAGE_BASE_URL: http://localhost:8000/storage/v1/object/public
      SUPABASE_STORAGE_BUCKET: posts-images
      AUTO_MIGRATE: ${AUTO_MIGRATE:-false}
      SKIP_MIGRATION: ${SKIP_MIGRATION:-false}
    ports:
      - "3002:3000"
    volumes:
      - .:/app
      - /app/node_modules
      - /app/.next
    networks:
      - muscle-pal-network

  # Same Supabase services as in main docker-compose.yml
  db:
    extends:
      file: docker-compose.yml
      service: db

  auth:
    extends:
      file: docker-compose.yml
      service: auth

  rest:
    extends:
      file: docker-compose.yml
      service: rest

  realtime:
    extends:
      file: docker-compose.yml
      service: realtime

  storage:
    extends:
      file: docker-compose.yml
      service: storage

  imgproxy:
    extends:
      file: docker-compose.yml
      service: imgproxy

  kong:
    extends:
      file: docker-compose.yml
      service: kong

  inbucket:
    extends:
      file: docker-compose.yml
      service: inbucket

  studio:
    extends:
      file: docker-compose.yml
      service: studio

  meta:
    extends:
      file: docker-compose.yml
      service: meta

volumes:
  db_data:
    driver: local
  storage_data:
    driver: local

networks:
  muscle-pal-network:
    driver: bridge
